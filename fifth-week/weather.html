<!doctype html>
<html lang="tr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hava Durumu | Q-Farm</title>
    <meta name="description"
        content="AnlÄ±k hava durumu, 7 gÃ¼nlÃ¼k tahmin. Ã‡iftÃ§iler iÃ§in geliÅŸtirilmiÅŸ hava durumu uygulamasÄ±." />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@600;700;800&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="style.css" />
</head>

<body class="weather-body">

    <!-- â•â•â• HEADER â•â•â• -->
    <div
        style="background: var(--header-bg); backdrop-filter: var(--header-blur); -webkit-backdrop-filter: var(--header-blur); position: sticky; top: 0; z-index: 100; box-shadow: 0 1px 20px rgba(0,0,0,0.15);">
        <nav
            style="display:flex; justify-content:space-between; align-items:center; max-width:1100px; margin:0 auto; padding:1rem 1.5rem;">
            <a href="index.html" class="logo" style="text-decoration:none;">Q-<span>Farm</span></a>
            <div style="display:flex; align-items:center; gap:1.5rem;">
                <a href="index.html"
                    style="color:rgba(255,255,255,0.8); font-weight:500; font-size:0.9rem; text-decoration:none; transition:color 0.3s;"
                    onmouseover="this.style.color='#f6ad3a'" onmouseout="this.style.color='rgba(255,255,255,0.8)'">â†
                    Anasayfa</a>
                <label class="bb8-toggle" title="TemayÄ± deÄŸiÅŸtir" aria-label="Tema deÄŸiÅŸtir">
                    <input class="bb8-toggle__checkbox" type="checkbox" id="theme-toggle"
                        onchange="toggleTheme(this.checked)">
                    <div class="bb8-toggle__container">
                        <div class="bb8-toggle__scenery">
                            <div class="bb8-toggle__star"></div>
                            <div class="bb8-toggle__star"></div>
                            <div class="bb8-toggle__star"></div>
                            <div class="bb8-toggle__star"></div>
                            <div class="bb8-toggle__star"></div>
                            <div class="bb8-toggle__star"></div>
                            <div class="bb8-toggle__star"></div>
                            <div class="tatto-1"></div>
                            <div class="tatto-2"></div>
                            <div class="gomrassen"></div>
                            <div class="hermes"></div>
                            <div class="chenini"></div>
                            <div class="bb8-toggle__cloud"></div>
                            <div class="bb8-toggle__cloud"></div>
                            <div class="bb8-toggle__cloud"></div>
                        </div>
                        <div class="bb8">
                            <div class="bb8__head-container">
                                <div class="bb8__antenna"></div>
                                <div class="bb8__antenna"></div>
                                <div class="bb8__head"></div>
                            </div>
                            <div class="bb8__body"></div>
                        </div>
                        <div class="artificial__hidden">
                            <div class="bb8__shadow"></div>
                        </div>
                    </div>
                </label>
            </div>
        </nav>
    </div>

    <!-- â•â•â• MAIN CONTENT â•â•â• -->
    <div class="weather-main">

        <!-- Page Title -->
        <div style="text-align:center; margin-bottom: 2.5rem;">
            <h1 class="section-title" style="margin-bottom:0.4rem;">ğŸŒ¤ï¸ Hava Durumu</h1>
            <p class="section-subtitle" style="margin-bottom:0;">Ã‡iftliÄŸiniz iÃ§in gÃ¼ncel hava bilgisi</p>
        </div>

        <!-- Search Box -->
        <div class="search-box">
            <input type="text" class="search-input" id="city-input"
                placeholder="Åehir adÄ± giriniz... (Ã¶rn: Ä°stanbul, Konya)" autocomplete="off"
                onkeydown="if(event.key==='Enter') searchWeather()" />
            <button class="search-btn" onclick="searchWeather()">ğŸ” Ara</button>
        </div>

        <!-- Results Area -->
        <div id="weather-results">
            <!-- Empty State -->
            <div class="weather-empty" id="empty-state">
                <div class="weather-empty-icon">ğŸŒ</div>
                <h3 style="color:var(--text); margin-bottom:0.5rem;">Åehir ArayÄ±n</h3>
                <p>Hava durumu bilgisi gÃ¶rmek iÃ§in yukarÄ±dan bir ÅŸehir arayÄ±n.<br>
                    <span style="font-size:0.85rem; opacity:0.7;">API: Open-Meteo (Ã¼cretsiz, kayÄ±t gerektirmez)</span>
                </p>
            </div>
        </div>

    </div><!-- /weather-main -->

    <!-- Footer -->
    <footer
        style="text-align:center; background: var(--primary); color: rgba(255,255,255,0.6); padding: 1.5rem; font-size: 0.85rem;">
        <p>Â© 2026 Q-Farm Â· Veriler: <a href="https://open-meteo.com/" target="_blank" rel="noopener"
                style="color:var(--accent);">Open-Meteo API</a></p>
    </footer>

    <script src="script.js"></script>
    <script>
        // ================================================================
        // TASK 5.3: WEATHER MICROAPP
        // Uses Open-Meteo (free, no API key) + Open-Meteo Geocoding API
        // ================================================================

        // WMO Weather Code â†’ Turkish description + emoji
        const WMO_CODES = {
            0: { label: 'AÃ§Ä±k', icon: 'â˜€ï¸' },
            1: { label: 'Ã‡oÄŸunlukla AÃ§Ä±k', icon: 'ğŸŒ¤ï¸' },
            2: { label: 'ParÃ§alÄ± Bulutlu', icon: 'â›…' },
            3: { label: 'Bulutlu', icon: 'â˜ï¸' },
            45: { label: 'Sisli', icon: 'ğŸŒ«ï¸' },
            48: { label: 'Dondurucu Sis', icon: 'ğŸŒ«ï¸' },
            51: { label: 'Hafif Ã‡iseleme', icon: 'ğŸŒ¦ï¸' },
            53: { label: 'Ã‡iseleme', icon: 'ğŸŒ¦ï¸' },
            55: { label: 'YoÄŸun Ã‡iseleme', icon: 'ğŸŒ¦ï¸' },
            61: { label: 'Hafif YaÄŸmur', icon: 'ğŸŒ§ï¸' },
            63: { label: 'YaÄŸmur', icon: 'ğŸŒ§ï¸' },
            65: { label: 'YoÄŸun YaÄŸmur', icon: 'ğŸŒ§ï¸' },
            71: { label: 'Hafif Kar', icon: 'ğŸŒ¨ï¸' },
            73: { label: 'Kar', icon: 'â„ï¸' },
            75: { label: 'YoÄŸun Kar', icon: 'â„ï¸' },
            77: { label: 'Kar Tanesi', icon: 'ğŸŒ¨ï¸' },
            80: { label: 'Hafif SaÄŸanak', icon: 'ğŸŒ¦ï¸' },
            81: { label: 'SaÄŸanak', icon: 'ğŸŒ§ï¸' },
            82: { label: 'YoÄŸun SaÄŸanak', icon: 'â›ˆï¸' },
            85: { label: 'Kar SaÄŸanaÄŸÄ±', icon: 'ğŸŒ¨ï¸' },
            86: { label: 'YoÄŸun Kar SaÄŸ.', icon: 'ğŸŒ¨ï¸' },
            95: { label: 'FÄ±rtÄ±na', icon: 'â›ˆï¸' },
            96: { label: 'FÄ±rt. + Dolu', icon: 'â›ˆï¸' },
            99: { label: 'Åiddetli FÄ±rtÄ±na', icon: 'â›ˆï¸' },
        };

        function getWMO(code) {
            return WMO_CODES[code] || { label: 'Bilinmiyor', icon: 'ğŸŒ¡ï¸' };
        }

        function shortDay(dateStr) {
            const days = ['Paz', 'Pzt', 'Sal', 'Ã‡ar', 'Per', 'Cum', 'Cmt'];
            return days[new Date(dateStr).getDay()];
        }

        function formatDate(dateStr) {
            const d = new Date(dateStr + 'T12:00:00');
            return d.toLocaleDateString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric' });
        }

        function showLoading() {
            document.getElementById('weather-results').innerHTML = `
        <div class="weather-loading">
          <div class="spinner"></div>
          <p>Hava durumu verileri alÄ±nÄ±yor...</p>
        </div>`;
        }

        function showError(msg) {
            document.getElementById('weather-results').innerHTML = `
        <div class="weather-error">
          <div style="font-size:3rem; margin-bottom:1rem;">âš ï¸</div>
          <h3 style="color:var(--text);">${msg}</h3>
          <p>Åehir adÄ±nÄ± doÄŸru yazdÄ±ÄŸÄ±nÄ±zdan emin olun.</p>
        </div>`;
        }

        async function searchWeather() {
            const city = document.getElementById('city-input').value.trim();
            if (!city) return;

            showLoading();

            try {
                // Step 1: Geocoding API â†’ lat/lon
                const geoRes = await fetch(
                    `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1&language=tr&format=json`
                );
                const geoData = await geoRes.json();

                if (!geoData.results || geoData.results.length === 0) {
                    showError(`"${city}" ÅŸehri bulunamadÄ±.`);
                    return;
                }

                const { latitude, longitude, name, country, admin1 } = geoData.results[0];
                const locationLabel = [name, admin1, country].filter(Boolean).join(', ');

                // Step 2: Weather API â†’ current + 7-day forecast
                const weatherRes = await fetch(
                    `https://api.open-meteo.com/v1/forecast?` +
                    `latitude=${latitude}&longitude=${longitude}` +
                    `&current=temperature_2m,apparent_temperature,relative_humidity_2m,` +
                    `wind_speed_10m,wind_direction_10m,precipitation,weather_code,uv_index,visibility` +
                    `&daily=temperature_2m_max,temperature_2m_min,weather_code,precipitation_sum,sunrise,sunset` +
                    `&wind_speed_unit=kmh&timezone=auto&forecast_days=7`
                );
                const wData = await weatherRes.json();

                renderWeather(locationLabel, wData);

            } catch (err) {
                showError('BaÄŸlantÄ± hatasÄ±. Ä°nternet baÄŸlantÄ±nÄ±zÄ± kontrol edin.');
                console.error(err);
            }
        }

        function windDir(deg) {
            const dirs = ['K', 'KKD', 'KD', 'DKD', 'D', 'DGD', 'GD', 'GGD', 'G', 'GGB', 'GB', 'BGB', 'B', 'KBB', 'KB', 'KKB'];
            return dirs[Math.round(deg / 22.5) % 16];
        }

        function renderWeather(location, data) {
            const c = data.current;
            const d = data.daily;
            const wmo = getWMO(c.weather_code);
            const today = new Date().toLocaleDateString('tr-TR', { weekday: 'long', day: 'numeric', month: 'long' });

            // 7-day forecast cards
            const forecastCards = d.time.map((date, i) => {
                const dWmo = getWMO(d.weather_code[i]);
                return `
          <div class="forecast-card">
            <div class="fc-day">${i === 0 ? 'BugÃ¼n' : shortDay(date)}</div>
            <div class="fc-icon-w">${dWmo.icon}</div>
            <div class="fc-max">${Math.round(d.temperature_2m_max[i])}Â°</div>
            <div class="fc-min">${Math.round(d.temperature_2m_min[i])}Â°</div>
          </div>`;
            }).join('');

            // Sunrise/sunset for today
            const sunrise = d.sunrise[0] ? d.sunrise[0].slice(11, 16) : '--:--';
            const sunset = d.sunset[0] ? d.sunset[0].slice(11, 16) : '--:--';

            const html = `
        <!-- Current Weather Card -->
        <div class="current-weather">
          <div class="weather-top">
            <div>
              <div class="weather-city">ğŸ“ ${location}</div>
              <div class="weather-date">${today}</div>
            </div>
            <div class="weather-icon-main">${wmo.icon}</div>
          </div>
          <div class="weather-bottom">
            <div>
              <div class="temp-big">${Math.round(c.temperature_2m)}Â°C</div>
              <div class="weather-desc">${wmo.label}</div>
              <div style="font-size:0.9rem; opacity:0.75; margin-top:0.3rem;">Hissedilen: ${Math.round(c.apparent_temperature)}Â°C</div>
            </div>
            <div class="weather-details-grid">
              <div class="detail-item"><span class="di-icon">ğŸ’§</span> Nem: %${c.relative_humidity_2m}</div>
              <div class="detail-item"><span class="di-icon">ğŸ’¨</span> RÃ¼zgar: ${Math.round(c.wind_speed_10m)} km/h ${windDir(c.wind_direction_10m)}</div>
              <div class="detail-item"><span class="di-icon">ğŸŒ§ï¸</span> YaÄŸÄ±ÅŸ: ${c.precipitation} mm</div>
              <div class="detail-item"><span class="di-icon">â˜€ï¸</span> UV: ${c.uv_index ?? 'N/A'}</div>
            </div>
          </div>
        </div>

        <!-- 7-Day Forecast -->
        <p class="forecast-title">ğŸ“… 7 GÃ¼nlÃ¼k Tahmin</p>
        <div class="forecast-grid">
          ${forecastCards}
        </div>

        <!-- Extra Info -->
        <div class="extra-cards">
          <div class="extra-card">
            <div class="ec-icon">ğŸŒ…</div>
            <div class="ec-label">GÃ¼n DoÄŸumu</div>
            <div class="ec-value">${sunrise}</div>
          </div>
          <div class="extra-card">
            <div class="ec-icon">ğŸŒ‡</div>
            <div class="ec-label">GÃ¼n BatÄ±mÄ±</div>
            <div class="ec-value">${sunset}</div>
          </div>
          <div class="extra-card">
            <div class="ec-icon">ğŸ‘ï¸</div>
            <div class="ec-label">GÃ¶rÃ¼ÅŸ Mesafesi</div>
            <div class="ec-value">${c.visibility != null ? (c.visibility / 1000).toFixed(1) + ' km' : 'N/A'}</div>
          </div>
          <div class="extra-card">
            <div class="ec-icon">ğŸŒ¡ï¸</div>
            <div class="ec-label">Max/Min BugÃ¼n</div>
            <div class="ec-value">${Math.round(d.temperature_2m_max[0])}Â° / ${Math.round(d.temperature_2m_min[0])}Â°</div>
          </div>
        </div>
      `;

            document.getElementById('weather-results').innerHTML = html;
        }

        // Auto-search Ä°stanbul on first load for a nice default experience
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('city-input').value = 'Ä°stanbul';
            searchWeather();
        });
    </script>
    <script src="chatbot.js"></script>
</body>

</html>